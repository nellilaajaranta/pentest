# h4 Sequel fish

Tero Karvisen [Tunkeutumistestaus 2023-kurssin](https://terokarvinen.com/2023/tunkeutumistestaus-2023-kevat/) h4-tehtäväraporttini.

## x) Lue ja tiivistä (Tässä x-alakohdassa ei tarvitse tehdä testejä tietokoneella, vain lukeminen tai kuunteleminen ja tiivistelmä riittää. Tiivistämiseen riittää muutama ranskalainen viiva. Cheatsheetistä voit poimia muutaman itselle relevantin kohdan.)

### Cialdinin suostuttelun periaatteet (haluamastasi lähteestä)

Lähde: https://worldofwork.io/2019/07/cialdinis-6-principles-of-persuasion/

Vastavuoroisuus (reciprocity)

	- Cialdinin mukaan ihminen ei halua tuntea olevansa velkaa muille, ja esim. saadessaan lahjan ihminen kokee tarvetta antaa lahjan antajalle jotain takaisin
	- Tätä hyödynnetään paljon myynnissä ja markkinoinnissa esim. ilmaisina tuotelahjoina

Niukkuus (scarcity)

	- Mitä vähemmän jotain on saatavilla, sitä enemmän ihmiset haluavat sitä
	- Koskee myös rajoitettua aikaa: kiireellisyyden tunne saa ihmisen toimimaan ajattelemattomammin (esim. jokin asia myynnissä vain rajoitetun ajan luo tunteen, että se tulee hankkia heti)

Auktoriteetti (authority)

	- Henkilö jolla on auktoriteettia ja/tai uskottavuutta tai ovat asiantuntevia alalla omaa paljon vaikutusvaltaa muihin ihmisiin

Sitoutuminen ja johdonmukaisuus (commitment and consistency)

	- Ihminen on usein hyvin sitoutunut totuttuihin tapoihin, ja tekee helpommin asioita jotka muistuttavat hänen aiemmin tekemiään asioita

Pitäminen (liking)

	- Ihminen on helpommin vaikutettavissa sellaisen toimesta, josta hän pitää

Konsensus/sosiaalinen paine (Consensus/social proof)

	- Ihmisillä on luontainen tarve kuulua joukkoon ja seuraavat mitä muut tekevät

### PortSwigger: SQL injection UNION attacks



### PortSwigger: SQL injection cheat sheet

## a) Kalassa. Laadi keihäskalasteluviesti (spear phising) kuvitteelliselle yritykselle. Tavoitteena on saada kohde avaamaan liitteenä oleva Excel-dokumentti ja laittamaan makrot päälle. Käytä ainakin kahta Cialdinin periaatetta. Selitä, miten näitä periaatteita on sovellettu viestiisi. Keksi skennario ja kohde itse. Käytä työssä vain kuvitteellisia yrityksiä ja henkilöitä. Viestiä ei lähetetä mihinkään, se tulee vain raporttiin. Liitteenä olevaa Excel-dokumenttia ei tarvitse tehdä, mutta jos siinä on jotain nokkelaa, voit kuvailla, mitä se olisi.

Hyökkääjä käyttää olemassaolevaa Firma-A:tä hyväksi kalastelukampanjassaan Firma B:tä kohtaan. Firma-A:n sähköpostiosoitteet ovat muotoa @firma-a.fi, mutta hyökkääjä on saanut hankittua domainin @firmaa.fi, josta lähettää tekaistun tarjouksen uudesta tuotteesta Firma B:n työntekijälle, joka löytyi LinkedInistä ja osoittautui siellä toimivansa hankintojen vastuuhenkilönä. Hyökkääjä käyttää lähettäjänä LinkedInistä löytämäänsä Firma-A:n työntekijän nimeä uskottavuuden lisäämiseksi.

"Hei Hyvä Työntekijä!

Olemme Firma-A:ssa kehittäneet uuden uraauurtavan tuotteen, joka mullistaa alamme toiminnan. Tuotettamme on kokeillut ja kehunut useampi alan ammattilainen ja sen käyttöönotto on jopa tuplannut yritysten tehokkuuden ja tuloksen.

Tarjoamme tuotettamme Teille nyt rajoitetun ajan erittäin hyvällä tarjouksella jopa -50% hankintahinnasta. Liitteenä on eriteltynä hinnoittelu sekä tarkempi esitelmä tuotteestamme.

Ystävällisin terveisin

Firma-A:n Työntekijä"

Kalasteluviesti seuraa Cieldinin periaatteista niukkuutta sanomalla että tarjous on voimassa vain rajoituetun ajan, konsensusta/sosiaalista painetta väittämällä, että muut alan yritykset ovat ottaneet tuotteen käyttöön sekä auktoriteettia, sillä hyökkääjä esiintyy olemassaolevana yrityksenä, johon luotetaan.

## PortSwigger labs

### b) SQL injection vulnerability allowing login bypass.

Tehtävä oli erittäin yksinkertainen, kohteeseen tuli päsäät kirjautumaan administrator-käyttäjänä. Kokeilin kohdesivuston kirjautumisnäkymässä tunnusta administrator ja -- -kommentti sen perään, jotta loppuosaa ei huomioida eli kirjoitin tekstikenttään "administrator'--" (ilman lainausmerkkejä):

![comment out]()

Tämä toimi, ja labra on suoritettu onnistuneesti:

![pass]()

### c) SQL injection UNION attack, determining the number of columns returned by the query.

Tehtävässä on verkkokaupan tuotekategoriafiltterissä haavoittuvuus, jota tulee hyödyntää UNION-hyökkäyksellä. Ensin tule selvittää, kuinka monta kolumnia kyselystä palautuu.`Kokeilin ensin aiemmin tiivistömöni Portswiggerin UNION attack-artikkelia apuna, ja klikkasin aktiiviseksi satunnaisen tuotefiltterin ja kokeilin ensin `' ORDER BY 1--` - metodia, eli kirjoitin kyseisen kyselyn sivun osoitekenttään osoitteen perään, mutta tästä ei tapahtunut mitään huomattavaa eikä labra tullut ratkaistuksi. Toinen artikkelin ehdottama `UNION SELECT NULL` -injektio kuitenkin toimi muodossa `'UNION SELECT NULL,NULL,NULL--`:

![UNION SELECT]()

### d) SQL injection UNION attack, finding a column containing text.

Tehtävässä on taas haavoittuvuus tuotekategoriafiltterissä, ja lisäksi saada tietokanta palauttamaan merkkijonon 'eTHXXF'. Tehtävässä käytetäänsamaa tekniikaka kuin äskeisessä, joten kokeilni ensimmäisenä sitä. Valitsin taas satunnaisen tuotekategoriafiltterin ja krijoitin sen perään `UNION SELECT NULL--`, ja lisäsin NULL-arvoja perään kunnes sain vastauksksi muuta kuin erroria:

![vastaus]()

Seuraavaksi kokeilin korvata yksittäin jokaisen NULL-arvon labran pyytämällä 'eTHXXF'-merkkijonolla. Toinen NULL-arvo anoit vastauksen, eli kysely oli muodossa `'UNION SELECT NULL,'eTHXXF',NULL--`

![Ratkaisu]()

### e) SQL injection UNION attack, retrieving data from other tables.

Tehtävässä yhdistetään aiempien labrojen ratkaisuja jälleen tuotekategorian haavoittuvuudessa. Tehtävän taustatiedoiksi sai, että tietokanta sisältää taulun "users", jossa kolumnit "username" ja "password". Käytin tätä kyselyn muodostukseen, ja klikkasin auki satunnaisen tuotekategoriafiltterin. Sen perään kirjoitin kyselyn:

`'UNION SELECT username, password FROM users--`
Tämä toimi, ja sivustolle tuli näkyviin käyttäjätunnuksia, mukaan lukien administrator. Tätä kokeilin sivustoon  kirjautumiseen, joka toimi:

![login]()

### f) SQL injection UNION attack, retrieving multiple values in a single column.
Tässä tehtävässä en oikein tiennyt mistä aloittaa, joten jouduin katsomaan tehtävän vastauksen sen solution-painikkeen alta:

![solution]()

Vastauksen perusteella tehtävässä tulee käyttää PostgreSQL:n merkkijonojen ketjutusta `||'~'||` -tavalla yhdistämään kysely hakemaan sekä username- ja password_arvot. Kokeilni tätä tehtävään, ja se toimi:

![portsw f2]()

![solved]()

### g) SQL injection attack, querying the database type and version on Oracle.

Tehtävän ratkaisuksi tulee selvittää tietokannan versio. Käytin apuna Portswiggerin SQL cheat sheetiä, jonka mukaan Oraclen version voi saada selville seuaavalla kyselyllä:

`SELECT banner FROM v$version`

Muodostin kyselyn esin seuraavanlaiseksi:

`'UNION SELECT banner FROM v$version--`

Tämä ei kuitenkaan palauttanut mitään, joten testasin lisätä mukaan NULL-arvon:

`' UNION SELECT banner,NULL FROM v$version--`

Tämä toimi, ja sain näkyviin version:

![w]()

![w]()


