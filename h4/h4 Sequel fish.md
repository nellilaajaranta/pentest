# h4 Sequel fish

Tero Karvisen [Tunkeutumistestaus 2023-kurssin](https://terokarvinen.com/2023/tunkeutumistestaus-2023-kevat/) h4-tehtäväraporttini.

## x) Lue ja tiivistä (Tässä x-alakohdassa ei tarvitse tehdä testejä tietokoneella, vain lukeminen tai kuunteleminen ja tiivistelmä riittää. Tiivistämiseen riittää muutama ranskalainen viiva. Cheatsheetistä voit poimia muutaman itselle relevantin kohdan.)

### Cialdinin suostuttelun periaatteet (haluamastasi lähteestä)
### PortSwigger: SQL injection UNION attacks
### PortSwigger: SQL injection cheat sheet

## a) Kalassa. Laadi keihäskalasteluviesti (spear phising) kuvitteelliselle yritykselle. Tavoitteena on saada kohde avaamaan liitteenä oleva Excel-dokumentti ja laittamaan makrot päälle. Käytä ainakin kahta Cialdinin periaatetta. Selitä, miten näitä periaatteita on sovellettu viestiisi. Keksi skennario ja kohde itse. Käytä työssä vain kuvitteellisia yrityksiä ja henkilöitä. Viestiä ei lähetetä mihinkään, se tulee vain raporttiin. Liitteenä olevaa Excel-dokumenttia ei tarvitse tehdä, mutta jos siinä on jotain nokkelaa, voit kuvailla, mitä se olisi.

## PortSwigger labs

### b) SQL injection vulnerability allowing login bypass.

Tehtävä oli erittäin yksinkertainen, kohteeseen tuli päsäät kirjautumaan administrator-käyttäjänä. Kokeilin kohdesivuston kirjautumisnäkymässä tunnusta administrator ja -- -kommentti sen perään, jotta loppuosaa ei huomioida eli kirjoitin tekstikenttään "administrator'--" (ilman lainausmerkkejä):

![comment out]()

Tämä toimi, ja labra on suoritettu onnistuneesti:

![pass]()

### c) SQL injection UNION attack, determining the number of columns returned by the query.

Tehtävässä on verkkokaupan tuotekategoriafiltterissä haavoittuvuus, jota tulee hyödyntää UNION-hyökkäyksellä. Ensin tule selvittää, kuinka monta kolumnia kyselystä palautuu.`Kokeilin ensin aiemmin tiivistömöni Portswiggerin UNION attack-artikkelia apuna, ja klikkasin aktiiviseksi satunnaisen tuotefiltterin ja kokeilin ensin `' ORDER BY 1--` - metodia, eli kirjoitin kyseisen kyselyn sivun osoitekenttään osoitteen perään, mutta tästä ei tapahtunut mitään huomattavaa eikä labra tullut ratkaistuksi. Toinen artikkelin ehdottama `UNION SELECT NULL` -injektio kuitenkin toimi muodossa `'UNION SELECT NULL,NULL,NULL--`:

![UNION SELECT]()

### d) SQL injection UNION attack, finding a column containing text.

Tehtävässä on taas haavoittuvuus tuotekategoriafiltterissä, ja lisäksi saada tietokanta palauttamaan merkkijonon 'eTHXXF'. Tehtävässä käytetäänsamaa tekniikaka kuin äskeisessä, joten kokeilni ensimmäisenä sitä. Valitsin taas satunnaisen tuotekategoriafiltterin ja krijoitin sen perään `UNION SELECT NULL--`, ja lisäsin NULL-arvoja perään kunnes sain vastauksksi muuta kuin erroria:

![vastaus]()

Seuraavaksi kokeilin korvata yksittäin jokaisen NULL-arvon labran pyytämällä 'eTHXXF'-merkkijonolla. Toinen NULL-arvo anoit vastauksen, eli kysely oli muodossa `'UNION SELECT NULL,'eTHXXF',NULL--`

![Ratkaisu]()

### e) SQL injection UNION attack, retrieving data from other tables.

Tehtävässä yhdistetään aiempien labrojen ratkaisuja jälleen tuotekategorian haavoittuvuudessa. Tehtävän taustatiedoiksi sai, että tietokanta sisältää taulun "users", jossa kolumnit "username" ja "password". Käytin tätä kyselyn muodostukseen, ja klikkasin auki satunnaisen tuotekategoriafiltterin. Sen perään kirjoitin kyselyn:

`'UNION SELECT username, password FROM users--`
Tämä toimi, ja sivustolle tuli näkyviin käyttäjätunnuksia, mukaan lukien administrator. Tätä kokeilin sivustoon  kirjautumiseen, joka toimi:

![login]()

### f) SQL injection UNION attack, retrieving multiple values in a single column.
Tässä tehtävässä en oikein tiennyt mistä aloittaa, joten jouduin katsomaan tehtävän vastauksen sen solution-painikkeen alta:

![solution]()

Vastauksen perusteella tehtävässä tulee käyttää PostgreSQL:n merkkijonojen ketjutusta `||'~'||` -tavalla yhdistämään kysely hakemaan sekä username- ja password_arvot. Kokeilni tätä tehtävään, ja se toimi:

![portsw f2]()

![solved]()

### g) SQL injection attack, querying the database type and version on Oracle.

Tehtävän ratkaisuksi tulee selvittää tietokannan versio. Käytin apuna Portswiggerin SQL cheat sheetiä, jonka mukaan Oraclen version voi saada selville seuaavalla kyselyllä:

`SELECT banner FROM v$version`

Muodostin kyselyn esin seuraavanlaiseksi:

`'UNION SELECT banner FROM v$version--`

Tämä ei kuitenkaan palauttanut mitään, joten testasin lisätä mukaan NULL-arvon:

`' UNION SELECT banner,NULL FROM v$version--`

Tämä toimi, ja sain näkyviin version:

![w]()

![w]()


