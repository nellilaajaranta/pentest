# h1 OmaLabra

Tero Karvisen [Tunkeutumistestaus 2023-kurssin](https://terokarvinen.com/2023/tunkeutumistestaus-2023-kevat/) h1-tehtäväraporttini.

## x) Lue ja tiivistä.

Tein tiivistelmän Darknet Diaries-podcastin jaksosta [11: Strictly Confidential](https://darknetdiaries.com/transcript/11/).

## a) Asenna Kali virtuaalikoneeseen

Latasin [Kali Linux](https://www.kali.org/get-kali/#kali-installer-images) Kali Installerin. 
Tämän jälkeen loin Virtualboxiin uuden virtuaalikoneen ja lisäsin lataamani Kali installerin virtuaalikoneen disk imageksi ja käynnistin virtuaalikoneen. 
Asennus oli yksinkertainen next-next tyylinen eikä vaatinut erityisiä toimenpiteitä.

## b) Asenna Metasploitable 2 virtuaalikoneeseen

Latasin [Metasploitable2](https://sourceforge.net/projects/metasploitable/) koneelleni. Tämän jälkeen loin uuden virtuaalikoneen VirtualBoxiin, 
jonka jälkeen menin kyseisen virtuaalikoneen storage-asetuksiin ja lisäsin lataamani Metasplotable2-vmdk-tiedoston virtuaalikoneen levyihin.

![Metasploitable2 harddisk](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h1/metasploitable2.jpg)

## c) Tee koneille virtuaaliverkko, jossa Kali saa yhteyden Internettiin, mutta sen voi laittaa pois päältä & Kalin ja Metasploitablen välillä on host-only network, niin että porttiskannatessa ym. koneet on eristetty intenetistä, mutta ne saavat yhteyden toisiinsa

Avasin VirtualBoxin Network Managerin ja loin uuden Host-only adapterin Create-painikkeesta Host-only välilehdellä. Sen jälkeen enabloin DHCP serverin kys. adapterille ja valitsin että adapteri konfiguroidaan automaattisesti.

![verkkomäärittely](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h1/verkkoma%CC%88a%CC%88ritys.jpg)

Kalin verkko-asetuksista kävin asettamassa Adapter 1 NAT-verkoksi sekä Adapter 2 juuri luomaani Host-only verkkoon. Tällöin Kalin saa halutessaan yhdistettyä internetiin yhdistämällä sen NAT-verkkoon.

![kali nat](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h1/kali%20nat.jpg)

![kali host only](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h1/kali%20host%20only.jpg)

Metasploitable2 verkko-asetuksista kävin määrittämässä Adapter 1 juuri luomani Host-only verkon, jolloin Kali ja Metasploitable2 voivat löytää toisensa tämän verkon kautta. Metasploitable2-koneen ei ole tarkoitus yhdistää verkkoon.

![metaspl2 host only](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h1/metasp2%20host%20only.jpg)

Käynnistin Kalin ja katsoin että se on yhteydessä NAT-verkkoon. Kali ei kuitenkaan saanut yhteyttä internetiin. Löysin korjauksen [VirtualBoxin foorumilta](https://forums.virtualbox.org/viewtopic.php?t=97599),
jossa yhden vastauksen mukaan komennolla `nmtui` saa aktivoitua NAT:in yhteyden. Komento avaa seuraavan näkymän:

![nmtui1](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h1/nmtui.jpg)

![nmtui2](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h1/nmtui2.jpg)

yhteyden aktivoinnin jälkeen NAT-verkon internet-yhteys alkoi toimia. 

kuva

Tämän jälkeen laitoin NAT-yhteyden pois VirtualBoxin network-asetuksista klikkaamalla "cable connected" ruksin pois.

![kali nat pois](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h1/kali%20nat%20pois.jpg)

Yhdistin Kalin Host-only verkkoon. Kokeilin vielä ettei se varmasti ole yhteydessä internetiin pingaamalla googlea:

![kali ping 8.8.8.8](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h1/kali%20google%20ping.jpg)

Tämän jälkeen käynnistin Metasploitable2 koneen ja kirjauduin siihe sisään. Kokeilin myös sillä ettei se ole yhteydessä verkkoon pingaamalla googlea:

![meta ping google](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h1/meta%20ping%20google.jpg)

Sitten tarkistin Metasploitable2 koneen ip-osoitteen `ifconfig`-komennolla ja pingasin Metasploitablea Kalilla varmistaakseni, että koneet löytävät toisnsa host-only verkossa.

![ping metasploitable2](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h1/metaslpoit%20ing.jpg)

## d) Etsi Metasploitable porttiskannaamalla (db_nmap -sn). Tarkista selaimella, että löysit oikean IP:n - Metasploitablen etusivulla lukee Metasploitable.

Avasin Kalin komentorivillä msfconsolen komennolla `sudo msfdb run`.

![msfconsole](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h1/console.jpg)

Sitten ajoin seuraavan komennon, jolla skannaan nmap-työkalulla haluamani verkon hostit:

`db_nmap -sn 192.168.115.0/24`

Metasploitable2 löytyi listasta:

![metasploitable2 nmap](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h1/nmap%201.jpg)

Aiemmin selvisi, että Metasploitable2 koneen ip-osoite on 192.168.115.5. Varmistin kuitenkin vielä tämän selaimen kautta:

![metaspl verkko](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h1/toimii.jpg)

## e) Porttiskannaa Metasploitable huolellisesti (db_nmap -A)

Skannasin Metasploitable2 seuraavalla komennolla:

`db_nmap -A 192.168.115.5`

![nmap](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h1/nmapskannaus.jpg)

kuvasta näkyy ftp-portti 21, jossa on vsftpd-palvelu. 

## f) Murtaudu Metasploitablen VsFtpd-palveluun Metasploitilla (search vsftpd, use 0, set RHOSTS - varmista osoite huolella, exploit, id)

Komento `search` etsii vsftpd-palveluun liittyviä tiedettyjä exploiteja tietokannasta. Vsftpd:lle löytyi backdoor-tyypin haavoittuvuus.

![search](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h1/vsftpd.jpg)

use -komento ja exploitin identifioiva numero valitsee kyseisen exploitin:

`use 0`

![use0](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h1/use0.jpg)

`show options - komento näyttää, mitä löydetyllä haavoittuvuudella voidaan tehdä. Kävi ilmi, että RHOSTS ei ole määritetty ja se tulisi määritellä. Tähän siis lisätään kohdekoneen (Metasploitable2) ip-osoite seuraavalla komennolla:

`set RHOSTS 192.168.115.5`

![rhost määritetty](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h1/rhosts%20ma%CC%88ritetty.jpg)

komennolla exploit saa suoritettua valitun exploitin.

![exploit](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h1/exploit.jpg)

Exploitin käyttö onnistui ja Metasploitable2-koneeseen on nyt Backdoorin kautta yhteys root-käyttäjänä, ja voin ajaa siihen komentoja:

![backdoor komennot](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h1/komentoja.jpg)



