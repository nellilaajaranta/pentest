Tero Karvisen [Tunkeutumistestaus 2023-kurssin](https://terokarvinen.com/2023/tunkeutumistestaus-2023-kevat/) h5-tehtäväraporttini.

### x) Lue ja tiivistä (Tässä x-alakohdassa ei tarvitse tehdä testejä tietokoneella, vain lukeminen tai kuunteleminen ja tiivistelmä riittää. Tiivistämiseen riittää muutama ranskalainen viiva.)
[Karvinen 2022: Cracking Passwords with Hashcat](https://terokarvinen.com/2022/cracking-passwords-with-hashcat/)

- Järjestelmät tallentavat salasanat hash-muodossa eli tiiviste, joita ihminen ei kykene muuntamaan takaisin alkuperäiseksi salasanaksi
- tietokone kykenee vertailemaan tiiviste "sanakirjaan" ja etsimään yhteensopivuuksia tiivisteen muuntamiseksi esim. Hashcat-ohjelmalla
- artikkeli ohjeistaa asentamaan Hashccatin, Hashid:n sekä sanakirjan (artikkelissa Rockyou)
- Tiivisteen tyyppi selvitetään ensin HashId:n avulla
- Tiivisteen saa murrettua komennolla `hashcat -m (tiivisteen tyyppi) 'tiiviste' rockyou.txt -o solved`
- komennossa hascat on ohjelma jota käytetään, -m (luku) on tiivisteen tyyppi, numero-kirjainsarja itse tiiviste, rockyou.txt on sanakirja jota käytetään, -o solved tallentaa ratkaisun "solved"-tiedostoon

[Karvinen 2023: Crack File Password With John](https://terokarvinen.com/2023/crack-file-password-with-john/)

- Tiedostotyyppejä voi enkryptata salasanalla, mutta näitä salauksia voi murtaa esim. John the ripper-ohjelmalla
- Artikkelissa ladataan John the Ripperin jumbo-versio
- salasanan murtamista varten tulee ensin purkaa tiiviste uuteen tiedostoon
- sen jälkeen käytetään John the ripper-ohjelmaa, joka tekee sanakirjahyökkäyksen tiivisteeseen

[Karvinen 2023: Find Hidden Web Directories - Fuzz URLs with ffuf](https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/)

- Ffuf-ohjelmaa käytetään salattujen/piilotettujen (verkko)hakemistojen löytämiseen
- Ffuf tarvitsee sanakirjan, joka sisältää yleisiä hakemistopäätteitä 
- Ffuf tarjoaa tuhansia eri vastauksia, joten niitä tarvitsee rajata - näistä tulisi päätellä, minkä parametrin avulla rajata vastauksia oikean hakemiston löytämiseen

### y) The SUPER ultimate Hakk3r Che33tsheet 0.0.1. Tee tiivistelmä omista ja kavereiden parhaista tunketumistekniikoista. Ole täsmällinen, liitä komennot mukaan. Tämän kohdan vastaus lienee pidempi kuin aiempien x-tehtävien. Viittaa lähteisiin. Tässä alakohdassa ei tarvitse ajaa komentoja tietokoneella.

- metasploit käynnistys: `sudo msfdb run` (käynnistää myös tietokannan msfconsolen lisäksi)
- exploitien löytäminen tiettyyn palveluun: `search` (palvelu)
- löydetyn exploitin käyttö: `use` (exploitin arvo)
- valitun exploitin käyttö: `exploit`
lähde: https://github.com/nellilaajaranta/pentest/blob/main/h1/OmaLabra.md

-  Nmap käyttö: `nmap` (parametrit) (ip-osoite)
nmap parametrejä:
-  tietyn portin skannaus: `-p` (portti)
-  palvelun versio: `sV`
-  enabloi käyttöjärjestelmän tunnistus, version tunnsitus, skriptiskannaus, traceroute: `-A`
lähde: https://nmap.org/book/man-briefoptions.html

SQL injektiot
- jos-arvo aina tosi: `OR 1=1`
- loppukyselyn kommentointi pois: `--`
- UNION-hykääys ja talujen määrän selvitys: `UNION SELECT NULL`
-lähteet: 
https://portswigger.net/web-security/sql-injection/cheat-sheet
https://github.com/nellilaajaranta/pentest/blob/main/h4/h4%20Sequel%20fish.md

### a) Asenna Hashcat ja testaa sen toiminta murtamalla esimerkkisalasana.

Apuna [Tero Karvisen ohje "Cracking Passwords with Hashcat"](https://terokarvinen.com/2022/cracking-passwords-with-hashcat/)

Asennus komennolla:

`sudo apt-get -y install hashid hashcat wget`

![hashcat1](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h5/hashcat_1.jpg)

Hashcat olikin jo asennettuna valmiiksi Kaliin. Seuraavaksi loin uuden hakemiston "hashed" ja menin siihen:

`mkdir hashed`
`cd hashed`

Seuraavaksi latasin "sanakirjan" komennolla:

`wget https://github.com/danielmiessler/SecLists/raw/master/Passwords/Leaked-Databases/rockyou.txt.tar.gz`

Ladatun paketin purkaminen:

`tar xf rockyou.txt.tar.gz`

Ladatun paketin poisto:

`rm rockyou.txt.tar.gz`

![hashcat2](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h5/hashcat_2.jpg)

Kokeilin purkaa ohjeessa ollutta hashia komennolla

`hashcat -m 0 '6b1628b016dff46e6fa35684be6acc96' rockyou.txt -o solved`

![hashcat3](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h5/hashcat_3.jpg)

^ hashcat toiminnassa

![hashcat4](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h5/hashcat_4.jpg)

### b) Salainen, mutta ei multa. Ratkaise dirfuzt-1 artikkelista Karvinen 2023: Find Hidden Web Directories - Fuzz URLs with ffuf

Latasin [dirfuzt-1:n Tero Karvisen ohjeesta](https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/) ja annoin ladatulle tiedostolle oikeudet `chmod u+x dirfuzt-1`. Sitten kokeilin sen käynnistystä:

![dirfuzt1](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h5/dirfuzt2.jpg)

Latasin seuraavaksi ffuf:n:

`wget https://github.com/ffuf/ffuf/releases/download/v2.0.0/ffuf_2.0.0_linux_amd64.tar.gz`

Purin ladatun tiedoston:

`tar -xf ffuf_2.0.0_linux_amd64.tar.gz`

![ffuf](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h5/ffuf.jpg)

Seuraavaksi asensin sanakirjan:

`wget https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/common.txt`

Tämän jälkeen otin internet-yhteyden pois käytöstä.

seuraavaksi ajoin komennon:

`./ffuf -w common.txt -u http://127.0.0.2:8000/FUZZ`

![ffuf](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h5/ffuf2.jpg)

Tällä löytyi lähes 5000 tulosta, ja suurin osa palauttaa webbisivulla tyhjää. Suurin osa tiedostoista on kooltaan 154, joten ne filtteröidään pois Filtteröinti tiedoston koon mukaan

`./ffuf -w common.txt -u http://127.0.0.2:8000/FUZZ -fs 154`

![ffuf](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h5/ffuf3.jpg)

Seuraavaksi testasin tuloksia ja .git sekä wp-admin olivat oikeat hakemistot:

![dirfuzt](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h5/dirfuzt3.jpg)

### c) Asenna John the Ripper ja testaa sen toiminta murtamalla jonkin esimerkkitiedoston salasana.

Tehtävän tukena käytin Tero Karvisen ohjetta [Crack File Password With John](https://terokarvinen.com/2023/crack-file-password-with-john/), josta komennot ovat peräisin

Ensimmäiseksi asensin John the ripperin käyttöä tukevia työkaluja seuraavalla komennolla:

`sudo apt-get -y install micro bash-completion git build-essential libssl-dev zlib1g zlib1g-dev zlib-gst libbz2-1.0 libbz2-dev atool zip wget`

---

Seuraavaksi asensin John the ripper Jumbo version komennolla:

`git clone --depth=1 https://github.com/openwall/john.git`

Seuraavaksi menin sijaintiin `cd john/src/` ja suoritin scriptin `./configure` , joka tunnistaa käytettävän ympäristön ja luo "makefilen" `make` -komennolle. Tässä kohtaa saa varoituksen mikäli jokin riippvuuus puuttuu - jotain puutteita oli mutta päätin silti edetä tehtävässä ennen niiden asennusta.

![john1](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h5/john1.jpg)

Seuraavaksi ajoin kuvassa näkyvän komennon:

`make -s clean && make -sj4`

Sen jälkeen menin sijaintiin /john/run/ ja suoritin Johnin:

![john2](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h5/john2.jpg)

Sitten latasin Tero Karvisen luoman esimerkki-zip-filen, joka tulee koittaa avata.

`wget https://TeroKarvinen.com/2023/crack-file-password-with-john/tero.zip`

Yritin sitten unzipata tiedoston, mutta se ei ole mahdollista salasanasuojauksen vuoksi.

![john3](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h5/john3.jpg)

Seuraavaksi zip-tiedostosta pitää luoda hash-tiedosto:

`zip2john tero.zip >tero.zip.hash`

Sitten käytin John-työkalua hashiin:

`john tero.zip.hash `

![john4](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h5/john4.jpg)

Kuvasta näkyy, että salasana olisi "butterfly". Sain zipin sillä auki ja tarkasteltua sen sisältöä.

![john5](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h5/john5.jpg)


### d) Jurpon sivut. Ohhoh, sieppasit juuri Jurpon Windowsista NTLM-tiivisteen 83f1cf89225005caeb4e52c9ea9b00e0 . Liitteenä Jurpon kotisivulta leikattu ja liimattu teksti. Tee oma hyökkäyssanakirja ja murra tiiviste myöhempää liikkumista (lateral movement) varten.

Liite:

`Jurpon kotisivu

MasterLazerMan on suosikkisankarini. Olen aika komea, koska harrastan thriatlonin lisäksi Foo Man Zhu -perinnepainia. Olen kotoisin Kouvolasta, jonka arkkitehtuuri saa sydämmeni sykkiimään vikkelämmin. 

Nähdään IRCissä, sähköpostissa tai DeepThinked-piilopalvelussa TORissa. `

Loin uuden hakemiston nimeltä jurpo, johon loin uuden txt-tiedoston nimeltä jurponkirja.txt. Tähän lisäsin Jurpo-tekstistä mahdollisis aavainsanoja sanakirjahyökkäystä varten.

![jurpo1]()

Seuaavaksi katsoin hashid:llä tiivisteen tyyppiä. Tämä on jo mainittu tehtävänannossa, joten poimin hashid:n ratkaisuista löytyvän NTLM:n hashcat-arvon 1000.

![jurpo2]()

Kokeilin siis tiivisteen purkamista seuraavalla komennolla:

`hashcat -m 1000 '83f1cf89225005caeb4e52c9ea9b00e0' jurponkirja.txt -o solved`

![jurpo3]()

Sen jälkeen katsoin `cat` -komennolla hashcat-komennossa luodun solved-tiedoston sisällön, josta selviää ratkaisu:

![jurpo4]()

Tiiviste on siis MasterLazerMan.

### e) Valitse 2: Ratkaise kaksi itse valitsemaasi tehtävää PortSwigger labs -sivulta. Tietysti sellaisia, jotka eivät ole olleet vielä läksynä.

Tein tehtävän https://portswigger.net/web-security/cross-site-scripting/reflected/lab-html-context-nothing-encoded

Verkkosivuston hakukentässä on haavoittuvuus, jota voi hyödyntää tekemällä siihen XSS-hyökkäyksen käyttäen alert-funktiota. Alertista on selitetty enemmän [Portswiggerin Cross-site scripting-artikkelissa](https://portswigger.net/web-security/cross-site-scripting)

Kokeilin sivuston hakukenttään seuraavaa kyselyä

`<script>alert()</script>`

![portswigger1](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h5/portswigger1.jpg)

![portswigger2](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h5/portswigger3.jpg)

![portswigger3](https://github.com/nellilaajaranta/pentest/blob/main/pictures/h5/portswigger2.jpg)


